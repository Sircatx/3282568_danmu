<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>æ€ªå°è‘µçš„å¼¹å¹•å½’æ¡£</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root { --pink: #ff69b4; --bg: #fdf2f5; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding: 15px; color: #444; }
        .container { max-width: 500px; margin: 0 auto; background: white; border-radius: 20px; padding: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); min-height: 90vh; }
        h1 { text-align: center; color: var(--pink); font-size: 1.4rem; border-bottom: 2px dashed #ffe4ed; padding-bottom: 10px; }
        
        /* æœç´¢æ¡†æ ·å¼ */
        .search-box { width: 100%; padding: 12px; border: 2px solid #ffe4ed; border-radius: 12px; margin-bottom: 15px; box-sizing: border-box; outline: none; transition: border-color 0.3s; }
        .search-box:focus { border-color: var(--pink); }

        /* å¹´ä»½åˆ†ç»„æ ‡é¢˜ */
        .year-header { background: var(--bg); color: var(--pink); padding: 8px 15px; border-radius: 8px; font-weight: bold; margin: 15px 0 10px 0; display: flex; justify-content: space-between; }
        
        .list { display: flex; flex-direction: column; gap: 8px; }
        .item { display: flex; align-items: center; padding: 14px; background: #fff; border: 1px solid #ffe4ed; border-radius: 12px; text-decoration: none; color: #555; cursor: pointer; transition: transform 0.1s; }
        .item:active { transform: scale(0.98); }
        
        .back-btn { background: var(--pink); color: white; border: none; padding: 8px 15px; border-radius: 10px; margin-bottom: 15px; cursor: pointer; font-weight: bold; }
        #content-viewer { display: none; background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 12px; font-family: monospace; white-space: pre-wrap; margin-top: 10px; max-height: 60vh; overflow-y: auto; font-size: 0.85rem; border: 2px solid #333; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ» æ€ªå°è‘µçš„å¼¹å¹•å½’æ¡£</h1>
        
        <input type="text" id="search-input" class="search-box" placeholder="ğŸ” è¾“å…¥å¹´æœˆæˆ–æ—¥æœŸæœç´¢..." oninput="filterData()">
        
        <div id="app"></div>
        <pre id="content-viewer"></pre>
    </div>

    <script>
        const repo = "Sircatx/3282568_danmu";
        let allMonths = []; // å­˜å‚¨æ‰€æœ‰æœˆä»½æ•°æ®
        let currentMonthFiles = []; // å­˜å‚¨å½“å‰æœˆçš„æ–‡ä»¶æ•°æ®

        // åˆå§‹åŒ–åŠ è½½
        async function init() {
            document.getElementById('content-viewer').style.display = 'none';
            document.getElementById('search-input').style.display = 'block';
            document.getElementById('app').innerHTML = '<div style="text-align:center;padding:20px;color:var(--pink)">æ­£åœ¨è¿æ¥æ—¶é—´ä»“åº“...</div>';
            
            try {
                const res = await fetch(`https://api.github.com/repos/${repo}/contents/`);
                const data = await res.json();
                allMonths = data.filter(item => item.type === 'dir' && /^\d{4}-\d{2}$/.test(item.name)).reverse();
                renderMonthList(allMonths);
            } catch (e) {
                document.getElementById('app').innerHTML = 'åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢ã€‚';
            }
        }

        // æ¸²æŸ“æœˆä»½åˆ—è¡¨ï¼ˆå¤–é¢ï¼‰
        function renderMonthList(list) {
            let html = '';
            let lastYear = '';
            list.forEach(item => {
                const year = item.name.split('-')[0];
                if (year !== lastYear) {
                    html += `<div class="year-header"><span>ğŸ“… ${year} å¹´</span></div>`;
                    lastYear = year;
                }
                html += `<div class="item" onclick="loadDates('${item.name}')">ğŸ“ ${item.name} å½’æ¡£è®°å½•</div>`;
            });
            document.getElementById('app').innerHTML = html || '<div style="text-align:center;padding:20px;">æ‰¾ä¸åˆ°ç›¸å…³æœˆä»½å“¦</div>';
        }

        // æ¸²æŸ“æ—¥æœŸåˆ—è¡¨ï¼ˆé‡Œé¢ï¼‰
        async function loadDates(month) {
            document.getElementById('search-input').placeholder = "ğŸ” æœç´¢å…·ä½“æ—¥æœŸ (å¦‚ 24)...";
            document.getElementById('search-input').value = ""; // è¿›å…¥æœˆä»½æ¸…ç©ºæœç´¢
            document.getElementById('app').innerHTML = `<button class="back-btn" onclick="init()">â¬… è¿”å›å¹´ä»½</button><div style="text-align:center;padding:20px;color:var(--pink)">è¯»å– ${month} æ—¥è®°ä¸­...</div>`;
            
            try {
                const res = await fetch(`https://api.github.com/repos/${repo}/contents/${month}`);
                currentMonthFiles = (await res.json()).filter(f => f.name.endsWith('.txt')).reverse();
                renderDateList(currentMonthFiles, month);
            } catch (e) {
                document.getElementById('app').innerHTML = 'è¯»å–å¤±è´¥ã€‚';
            }
        }

        function renderDateList(files, month) {
            let html = `<button class="back-btn" onclick="init()">â¬… è¿”å›ç›®å½•</button><div class="list">`;
            files.forEach(file => {
                html += `<div class="item" onclick="viewFile('${month}/${file.name}')">ğŸ“„ ${file.name.replace('.txt','')}</div>`;
            });
            document.getElementById('app').innerHTML = html + '</div>';
        }

        // å®æ—¶è¿‡æ»¤æœç´¢é€»è¾‘
        function filterData() {
            const keyword = document.getElementById('search-input').value.toLowerCase();
            const isInsideMonth = document.querySelector('.back-btn') !== null;

            if (!isInsideMonth) {
                const filtered = allMonths.filter(m => m.name.includes(keyword));
                renderMonthList(filtered);
            } else {
                const filtered = currentMonthFiles.filter(f => f.name.includes(keyword));
                const monthTitle = document.querySelector('strong')?.innerText || "";
                renderDateList(filtered, ""); 
                // ä¿®æ­£ï¼šåœ¨æ—¥æœŸé¡µæœç´¢æ—¶ä¿æŒè¿”å›æŒ‰é’®
                const backBtn = `<button class="back-btn" onclick="init()">â¬… è¿”å›ç›®å½•</button>`;
                document.getElementById('app').insertAdjacentHTML('afterbegin', '');
            }
        }

        // æŸ¥çœ‹å¼¹å¹•å†…å®¹ï¼ˆä¿æŒä¹‹å‰ç¨³å®šçš„æŠ“å–é€»è¾‘ï¼‰
        async function viewFile(filePath) {
            const viewer = document.getElementById('content-viewer');
            viewer.innerHTML = "æ­£åœ¨å¬å”¤å¼¹å¹•å†…å®¹...";
            viewer.style.display = 'block';
            window.scrollTo(0, document.body.scrollHeight);
            
            try {
                const proxyUrl = `https://mirror.ghproxy.com/https://raw.githubusercontent.com/${repo}/main/${filePath}`;
                const res = await fetch(proxyUrl);
                viewer.textContent = await res.text();
            } catch (e) {
                viewer.textContent = "å†…å®¹è¯»å–å¤±è´¥ã€‚";
            }
        }

        init();
    </script>
</body>
</html>
