<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>æ€ªå°è‘µçš„å¼¹å¹•å½’æ¡£</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root { --pink: #ff69b4; --soft-pink: #ffecf2; --bg: #fdf2f5; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 15px; }
        .container { max-width: 500px; margin: 0 auto; background: white; border-radius: 30px; padding: 25px; box-shadow: 0 15px 35px rgba(255,105,180,0.1); min-height: 85vh; }
        
        /* æ ‡é¢˜ç¾åŒ– */
        .header-title { text-align: center; color: var(--pink); font-size: 1.6rem; margin-bottom: 25px; font-weight: 800; letter-spacing: 1px; }
        
        /* æœç´¢æ¡†ç¾åŒ– */
        .search-box { width: 100%; padding: 15px; border: 2px solid var(--soft-pink); border-radius: 18px; margin-bottom: 20px; box-sizing: border-box; outline: none; font-size: 1rem; transition: all 0.3s; }
        .search-box:focus { border-color: var(--pink); box-shadow: 0 0 10px rgba(255,105,180,0.1); }

        /* æ–‡ä»¶å¤¹å¡ç‰‡æ ·å¼ */
        .grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
        .folder-card { position: relative; background: #fff; border-radius: 18px; padding: 20px; display: flex; align-items: center; border: 1px solid #eee; cursor: pointer; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); overflow: hidden; }
        .folder-card::before { content: ""; position: absolute; left: 0; top: 0; height: 100%; width: 6px; background: var(--pink); }
        .folder-card:hover { transform: translateY(-5px) scale(1.02); box-shadow: 0 10px 20px rgba(0,0,0,0.05); border-color: var(--pink); }
        
        .icon-box { font-size: 2.2rem; margin-right: 18px; filter: drop-shadow(0 4px 5px rgba(0,0,0,0.1)); }
        .folder-info { display: flex; flex-direction: column; }
        .folder-name { font-weight: bold; font-size: 1.1rem; color: #333; }
        .folder-desc { font-size: 0.8rem; color: #999; margin-top: 4px; }

        /* å¹´ä»½æ ‡ç­¾ */
        .year-tag { background: var(--pink); color: white; padding: 5px 15px; border-radius: 50px; font-size: 0.8rem; font-weight: bold; margin: 15px 0 10px 0; width: fit-content; }

        .back-btn { background: #333; color: white; border: none; padding: 10px 20px; border-radius: 12px; margin-bottom: 20px; cursor: pointer; font-weight: bold; transition: opacity 0.2s; }
        #viewer { display: none; background: #282c34; color: #abb2bf; padding: 20px; border-radius: 18px; white-space: pre-wrap; margin-top: 15px; max-height: 50vh; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 0.85rem; border: 4px solid #3e4451; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-title">ğŸŒ» æ€ªå°è‘µçš„å½’æ¡£ç«™</div>
        <input type="text" id="search" class="search-box" placeholder="ğŸ” å¿«é€Ÿæœç´¢æœˆä»½æˆ–æ—¥æœŸ..." oninput="doSearch()">
        <div id="app"></div>
        <pre id="viewer"></pre>
    </div>

    <script>
        const repo = "Sircatx/3282568_danmu";
        let rawData = [];
        let subData = [];

        async function init() {
            document.getElementById('viewer').style.display = 'none';
            document.getElementById('search').style.display = 'block';
            const res = await fetch(`https://api.github.com/repos/${repo}/contents/`);
            rawData = (await res.json()).filter(i => /^\d{4}-\d{2}$/.test(i.name)).reverse();
            renderMonths(rawData);
        }

        function renderMonths(list) {
            let html = '', lastYear = '';
            list.forEach(item => {
                const year = item.name.split('-')[0];
                if (year !== lastYear) {
                    html += `<div class="year-tag">${year} YEAR</div>`;
                    lastYear = year;
                }
                html += `
                    <div class="folder-card" onclick="openMonth('${item.name}')">
                        <div class="icon-box">ğŸ“‚</div>
                        <div class="folder-info">
                            <span class="folder-name">${item.name} å½’æ¡£</span>
                            <span class="folder-desc">ç‚¹å‡»æŸ¥çœ‹è¯¥æœˆæ‰€æœ‰å¼¹å¹•è®°å½•</span>
                        </div>
                    </div>`;
            });
            document.getElementById('app').innerHTML = html || '<p style="text-align:center;color:#999">ç©ºç©ºå¦‚ä¹Ÿ~</p>';
        }

        async function openMonth(m) {
            document.getElementById('search').placeholder = "ğŸ” æœç´¢å…·ä½“æ—¥æœŸ...";
            document.getElementById('app').innerHTML = '<button class="back-btn" onclick="init()">â¬… è¿”å›é¦–é¡µ</button><p>æ­£åœ¨å¼€å¯æ¡£æ¡ˆ...</p>';
            const res = await fetch(`https://api.github.com/repos/${repo}/contents/${m}`);
            subData = (await res.json()).filter(f => f.name.endsWith('.txt')).reverse();
            renderFiles(subData, m);
        }

        function renderFiles(files, m) {
            let html = `<button class="back-btn" onclick="init()">â¬… è¿”å›é¦–é¡µ</button><div class="grid">`;
            files.forEach(f => {
                html += `
                    <div class="folder-card" onclick="view('${m}/${f.name}')">
                        <div class="icon-box">ğŸ“„</div>
                        <div class="folder-info">
                            <span class="folder-name">${f.name.replace('.txt','')}</span>
                            <span class="folder-desc">TXT æ–‡æœ¬æ–‡ä»¶</span>
                        </div>
                    </div>`;
            });
            document.getElementById('app').innerHTML = html + '</div>';
        }

        function doSearch() {
            const k = document.getElementById('search').value.toLowerCase();
            const isSub = !!document.querySelector('.back-btn');
            if(!isSub) renderMonths(rawData.filter(m => m.name.includes(k)));
            else renderFiles(subData.filter(f => f.name.includes(k)), "");
        }

        async function view(p) {
            const v = document.getElementById('viewer');
            v.style.display = 'block';
            v.innerText = "æ­£åœ¨è§£å¯†å†…å®¹...";
            const res = await fetch(`https://mirror.ghproxy.com/https://raw.githubusercontent.com/${repo}/main/${p}`);
            v.innerText = await res.text();
            window.scrollTo(0, v.offsetTop);
        }

        init();
    </script>
</body>
</html>
