<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>æ€ªå°è‘µçš„å¼¹å¹•å½’æ¡£</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root { --pink: #ff69b4; --bg: #fdf2f5; --card-border: #ffe4ed; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 15px; }
        .container { max-width: 500px; margin: 0 auto; background: white; border-radius: 25px; padding: 20px; box-shadow: 0 10px 30px rgba(255,105,180,0.1); min-height: 85vh; }
        .header { text-align: center; color: var(--pink); font-size: 1.5rem; font-weight: bold; margin-bottom: 20px; border-bottom: 2px dashed var(--card-border); padding-bottom: 15px; }
        
        /* æœç´¢æ¡† */
        .search-box { width: 100%; padding: 12px 15px; border: 2px solid var(--card-border); border-radius: 12px; margin-bottom: 20px; box-sizing: border-box; outline: none; transition: 0.3s; }
        .search-box:focus { border-color: var(--pink); }

        /* å¹´ä»½åˆ†å‰²çº¿æ ·å¼ */
        .year-divider { display: flex; align-items: center; margin: 25px 0 15px 0; color: var(--pink); font-weight: bold; font-size: 0.9rem; }
        .year-divider::after { content: ""; flex: 1; height: 1px; background: var(--card-border); margin-left: 10px; }

        /* æ–‡ä»¶å¤¹å¡ç‰‡ */
        .folder-grid { display: flex; flex-direction: column; gap: 12px; }
        .card { display: flex; align-items: center; padding: 16px; background: #fff; border: 1.5px solid #f5f5f5; border-radius: 16px; cursor: pointer; transition: all 0.2s; position: relative; }
        .card:hover { border-color: var(--pink); background: #fffafc; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255,105,180,0.1); }
        
        .icon { font-size: 1.8rem; margin-right: 15px; }
        .info { display: flex; flex-direction: column; }
        .name { font-weight: bold; color: #444; font-size: 1.05rem; }
        .sub { font-size: 0.75rem; color: #999; margin-top: 2px; }

        /* è¿”å›ä¸å†…å®¹æŸ¥çœ‹ */
        .back-btn { background: #444; color: white; border: none; padding: 10px 20px; border-radius: 10px; margin-bottom: 15px; cursor: pointer; font-weight: bold; }
        #viewer { display: none; background: #222; color: #eee; padding: 15px; border-radius: 12px; font-family: monospace; white-space: pre-wrap; font-size: 0.85rem; margin-top: 15px; max-height: 50vh; overflow-y: auto; border: 3px solid #333; }
        .loading { text-align: center; padding: 50px; color: var(--pink); font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">ğŸŒ» æ€ªå°è‘µçš„å½’æ¡£ç«™</div>
        <input type="text" id="search" class="search-box" placeholder="ğŸ” å¿«é€Ÿæœç´¢..." oninput="doSearch()">
        <div id="app"><div class="loading">æ­£åœ¨åŠ è½½æ¡£æ¡ˆ...</div></div>
        <pre id="viewer"></pre>
    </div>

    <script>
        const repo = "Sircatx/3282568_danmu";
        const app = document.getElementById('app');
        const viewer = document.getElementById('viewer');
        let monthCache = []; // é¦–é¡µæœˆä»½ç¼“å­˜
        let fileCache = [];  // æ—¥æœŸæ–‡ä»¶ç¼“å­˜
        let isAtHome = true;

        // åŠ è½½é¦–é¡µï¼šæœˆä»½æ–‡ä»¶å¤¹
        async function loadHome() {
            isAtHome = true;
            viewer.style.display = 'none';
            app.innerHTML = '<div class="loading">æ­£åœ¨è¯»å–å¹´ä»½å½’æ¡£...</div>';
            try {
                const res = await fetch(`https://api.github.com/repos/${repo}/contents/`);
                const data = await res.json();
                monthCache = data.filter(i => /^\d{4}-\d{2}$/.test(i.name)).reverse();
                renderMonths(monthCache);
            } catch (e) { app.innerHTML = 'è¯»å–å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œã€‚'; }
        }

        // æ¸²æŸ“æœˆä»½ï¼ˆå¸¦å¹´ä»½åˆ†ç»„ï¼‰
        function renderMonths(list) {
            let html = '<div class="folder-grid">';
            let lastYear = '';
            list.forEach(item => {
                const year = item.name.split('-')[0];
                if (year !== lastYear) {
                    html += `<div class="year-divider">ğŸ“… ${year} å¹´</div>`;
                    lastYear = year;
                }
                html += `
                    <div class="card" onclick="loadDates('${item.name}')">
                        <div class="icon">ğŸ“‚</div>
                        <div class="info">
                            <span class="name">${item.name} å½’æ¡£</span>
                            <span class="sub">åŒ…å«è¯¥æœˆæ‰€æœ‰å¼¹å¹•è®°å½•</span>
                        </div>
                    </div>`;
            });
            app.innerHTML = html + '</div>';
        }

        // åŠ è½½å…·ä½“æ—¥æœŸæ–‡ä»¶
        async function loadDates(month) {
            isAtHome = false;
            app.innerHTML = `<button class="back-btn" onclick="loadHome()">â¬… è¿”å›</button><div class="loading">æ•´ç† ${month} ä¸­...</div>`;
            try {
                const res = await fetch(`https://api.github.com/repos/${repo}/contents/${month}`);
                const data = await res.json();
                fileCache = data.filter(f => f.name.endsWith('.txt')).reverse();
                renderFiles(fileCache, month);
            } catch (e) { app.innerHTML = 'æ—¥æœŸåŠ è½½å¤±è´¥ã€‚'; }
        }

        function renderFiles(files, month) {
            let html = `<button class="back-btn" onclick="loadHome()">â¬… è¿”å›ç›®å½•</button><div class="folder-grid">`;
            files.forEach(f => {
                html += `
                    <div class="card" onclick="viewFile('${month}/${f.name}')">
                        <div class="icon">ğŸ“„</div>
                        <div class="info">
                            <span class="name">${f.name.replace('.txt','')}</span>
                            <span class="sub">TXT æ–‡æœ¬å†…å®¹</span>
                        </div>
                    </div>`;
            });
            app.innerHTML = html + '</div>';
        }

        // æœç´¢é€»è¾‘
        function doSearch() {
            const k = document.getElementById('search').value.toLowerCase();
            if (isAtHome) {
                renderMonths(monthCache.filter(m => m.name.includes(k)));
            } else {
                renderFiles(fileCache.filter(f => f.name.includes(k)), "");
            }
        }

        // æŸ¥çœ‹æ–‡ä»¶
        async function viewFile(path) {
            viewer.style.display = 'block';
            viewer.innerText = 'æ­£åœ¨è¯»å–...';
            const res = await fetch(`https://mirror.ghproxy.com/https://raw.githubusercontent.com/${repo}/main/${path}`);
            viewer.innerText = await res.text();
            window.scrollTo(0, viewer.offsetTop);
        }

        loadHome();
    </script>
</body>
</html>
