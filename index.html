<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>æ€ªå°è‘µçš„å¼¹å¹•å½’æ¡£</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root { --pink: #ff69b4; --bg: #fdf2f5; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding: 15px; }
        .container { max-width: 500px; margin: 0 auto; background: white; border-radius: 20px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); min-height: 80vh; }
        .title { text-align: center; color: var(--pink); font-size: 1.4rem; font-weight: bold; padding-bottom: 15px; border-bottom: 2px dashed #ffe4ed; }
        
        /* æœç´¢æ¡† */
        .search-input { width: 100%; padding: 12px; border: 2px solid #ffe4ed; border-radius: 10px; margin: 15px 0; box-sizing: border-box; }

        /* å¹´ä»½æ ‡ç­¾ï¼šä½ æƒ³è¦çš„åˆ†ç±» */
        .year-label { background: #fff0f5; color: var(--pink); padding: 5px 12px; border-radius: 6px; font-weight: bold; margin: 20px 0 10px 0; font-size: 0.9rem; border-left: 4px solid var(--pink); }

        /* æ–‡ä»¶å¤¹å¡ç‰‡æ ·å¼ */
        .folder-card { display: flex; align-items: center; padding: 15px; background: #fff; border: 1px solid #eee; border-radius: 12px; cursor: pointer; margin-bottom: 10px; transition: 0.2s; }
        .folder-card:hover { border-color: var(--pink); transform: translateX(5px); }
        .icon { font-size: 1.5rem; margin-right: 12px; }
        .name { font-weight: 500; color: #333; }

        .btn { background: #444; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; margin-bottom: 15px; }
        #viewer { display: none; background: #1a1a1a; color: #ccc; padding: 15px; border-radius: 10px; font-family: monospace; white-space: pre-wrap; margin-top: 15px; max-height: 50vh; overflow-y: auto; font-size: 0.85rem; }
        .status { text-align: center; padding: 30px; color: #999; }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">ğŸŒ» æ€ªå°è‘µçš„å¼¹å¹•å½’æ¡£</div>
        <input type="text" id="q" class="search-input" placeholder="ğŸ” æœç´¢æ—¥æœŸæˆ–æœˆä»½..." oninput="doSearch()">
        <div id="content"></div>
        <pre id="viewer"></pre>
    </div>

    <script>
        const repo = "Sircatx/3282568_danmu";
        const content = document.getElementById('content');
        const viewer = document.getElementById('viewer');
        let months = []; // å­˜å‚¨é¦–é¡µæ•°æ®

        async function init() {
            viewer.style.display = 'none';
            content.innerHTML = '<div class="status">æ­£åœ¨æ‰“å¼€ä»“åº“...</div>';
            try {
                const res = await fetch(`https://api.github.com/repos/${repo}/contents/`);
                const data = await res.json();
                // ç­›é€‰å¹´æœˆæ–‡ä»¶å¤¹å¹¶å€’åºæ’
                months = data.filter(i => /^\d{4}-\d{2}$/.test(i.name)).reverse();
                renderMonths(months);
            } catch (e) { content.innerHTML = '<div class="status">è¯»å–å¤±è´¥ï¼Œè¯·åˆ·æ–°è¯•è¯•</div>'; }
        }

        // æ¸²æŸ“å¹´ä»½åˆ†ç»„
        function renderMonths(list) {
            let html = '', lastYear = '';
            list.forEach(item => {
                const year = item.name.split('-')[0];
                if (year !== lastYear) {
                    html += `<div class="year-label">ğŸ“… ${year} å¹´</div>`;
                    lastYear = year;
                }
                html += `<div class="folder-card" onclick="goFolder('${item.name}')"><span class="icon">ğŸ“‚</span><span class="name">${item.name} å½’æ¡£è®°å½•</span></div>`;
            });
            content.innerHTML = html || '<div class="status">æ²¡æ‰¾åˆ°æ–‡ä»¶å¤¹</div>';
        }

        async function goFolder(m) {
            content.innerHTML = `<button class="btn" onclick="init()">â¬… è¿”å›</button><div class="status">åŠ è½½ ${m}...</div>`;
            try {
                const res = await fetch(`https://api.github.com/repos/${repo}/contents/${m}`);
                const files = (await res.json()).filter(f => f.name.endsWith('.txt')).reverse();
                let html = `<button class="btn" onclick="init()">â¬… è¿”å›é¦–é¡µ</button>`;
                files.forEach(f => {
                    html += `<div class="folder-card" onclick="view('${m}/${f.name}')"><span class="icon">ğŸ“„</span><span class="name">${f.name.replace('.txt','')}</span></div>`;
                });
                content.innerHTML = html;
            } catch (e) { content.innerHTML = 'åŠ è½½æ–‡ä»¶å¤¹å†…å®¹å¤±è´¥'; }
        }

        function doSearch() {
            const k = document.getElementById('q').value;
            renderMonths(months.filter(m => m.name.includes(k)));
        }

        async function view(p) {
            viewer.style.display = 'block';
            viewer.innerText = 'è¯»å–ä¸­...';
            try {
                const res = await fetch(`https://mirror.ghproxy.com/https://raw.githubusercontent.com/${repo}/main/${p}`);
                viewer.innerText = await res.text();
                window.scrollTo(0, viewer.offsetTop);
            } catch (e) { viewer.innerText = 'å†…å®¹è¯»å–å¤±è´¥'; }
        }

        init();
    </script>
</body>
</html>
